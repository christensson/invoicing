<!doctype html>

<require module="i18next" var="i18n" />

<def function="condCheckIcon(cond)">
  <span data-bind="if: ${cond}">
    <span class="form-control-static glyphicon glyphicon-ok" aria-hidden="true"></span>
  </span>
</def>

<def function="condLockIcon(cond)">
  <span data-bind="if: ${cond}">
    <span class="form-control-static glyphicon glyphicon-lock" aria-hidden="true"></span>
  </span>
</def>

<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>${i18n.t('app.pageTitle')}</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <!-- <link href="bootstrap-theme.min.css" rel="stylesheet"> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="page.css">
  </head>
  <body role="document">
    <nav class="navbar navbar-default navbar-fixed-top" id="app-navbar">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#/page/home">${i18n.t('app.navBar.title')}</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav" data-bind="foreach: mainViews">
            <li data-bind="if: \$data.location == 'main', css: { active : \$data.name == \$root.currentView() }">
              <a href="#" data-bind="click: \$root.selectView">
                  <span class="glyphicon" data-bind="css: \$data.icon" aria-hidden="true"></span>
                  <span data-bind="text: \$data.title"></span>
              </a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                  <span class="glyphicon glyphicon-briefcase" aria-hidden="true"></span><span data-bind="text: activeCompanyName"></span>
                  <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" role="menu" >
                <html-comment> ko foreach: companyList </html-comment>
                  <li data-bind="css: { active: \$data._id() == \$parent.activeCompanyId() }">
                    <a href='#' data-bind="click: \$root.selectCompany">
                      <span data-bind="text: \$data.name"></span>
                      <invoke function="condCheckIcon" cond="\$data._id() == \$parent.activeCompanyId()"/>
                    </a>
                  </li>
                <html-comment> /ko </html-comment>
                <li role="separator" class="divider"></li>
                <html-comment> ko foreach: mainViews </html-comment>
                  <li data-bind="if: \$data.location == 'companyMenu'">
                    <a href='#' data-bind="click: \$root.selectView">
                        <span class="glyphicon" data-bind="css: \$data.icon" aria-hidden="true"></span>
                        <span data-bind="text: \$data.title"></span>
                    </a>
                  </li>
                <html-comment> /ko </html-comment>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                  <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                  $data.user.name
                  <span if="data.user.isAdmin === true" class="label label-primary">${i18n.t('app.navBar.adminUserLbl')}</span>
                  <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" role="menu" data-bind="foreach: mainViews">
                <li data-bind="if: \$data.location == 'userMenu'">
                  <a href='#' data-bind="click: \$root.selectView">
                      <span class="glyphicon" data-bind="css: \$data.icon" aria-hidden="true"></span>
                      <span data-bind="text: \$data.title"></span>
                  </a>
                </li>
                <li data-bind="if: \$data.location == 'userMenuNoRoute'">
                  <a data-bind="attr: {href: \$data.name}">
                      <span class="glyphicon" data-bind="css: \$data.icon" aria-hidden="true"></span>
                      <span data-bind="text: \$data.title"></span>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div id="layout">
      <div id="main" class="container">
        <include template="./notification.marko"/>

        <div id="app-home" data-bind="visible: currentView() == 'home'" style="display: none">
          <div class="page-header">
              <h1>${i18n.t('app.home.pageHeader')}</h1>
          </div>

          <div>
            <p data-bind="i18n: 'app.home.greetingsText'"></p>

            <p></p>
            <div class="panel-group">
              <div class="col-md-4">
                <div class="panel" data-bind='css: {"panel-primary": numCompanies() == 0, "panel-success": numCompanies() > 0}'>
                  <div class="panel-heading"><h3 class="panel-title">${i18n.t('app.gettingStarted.companiesHeader')}</h3></div>
                  <div class="panel-body">
                    <p><span data-bind="html: companiesTextTrans"></span></p>
                    <div class="btn-group" role="group">
                      <a href="#/page/company_new" type="button" class="btn btn-success">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                        ${i18n.t('app.gettingStarted.companiesNewCompanyBtn')}
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div data-bind="if: numCompanies() > 0">
                  <div class="panel" data-bind='css: {"panel-primary": numCustomers() == 0, "panel-success": numCustomers() > 0}'>
                    <div class="panel-heading"><h3 class="panel-title">${i18n.t('app.gettingStarted.customersHeader')}</h3></div>
                    <div class="panel-body">
                      <p><span data-bind="html: customersTextTrans"></span></p>
                      <div class="btn-group" role="group">
                        <a href="#/page/customer_new" type="button" class="btn btn-success">
                          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                          ${i18n.t('app.gettingStarted.customersNewCustomerBtn')}
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div data-bind="if: numCustomers() > 0">
                  <div class="panel" data-bind='css: {"panel-primary": numInvoices() == 0, "panel-success": numInvoices() > 0}'>
                    <div class="panel-heading"><h3 class="panel-title">${i18n.t('app.gettingStarted.invoicesHeader')}</h3></div>
                    <div class="panel-body">
                      <p><span data-bind="html: invoicesTextTrans"></span></p>
                      <div class="btn-group" role="group">
                        <a href="#/page/invoice_new" type="button" class="btn btn-success">
                          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                          ${i18n.t('app.gettingStarted.invoicesNewInvoiceBtn')}
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div id="app-companies" data-bind="visible: currentView() == 'companies'" style="display: none">
          <form>
            <p>
              <table class="table table-striped table-condensed">
                <thead>
                  <tr>
                    <th></th>
                    <th>${i18n.t('app.companyList.nameCol')}</th>
                    <th>${i18n.t('app.companyList.addrCol', {nr: 1})}</th>
                    <th>${i18n.t('app.companyList.addrCol', {nr: 2})}</th>
                    <th>${i18n.t('app.companyList.addrCol', {nr: 3})}</th>
                  </tr>
                </thead>
                <tbody data-bind="foreach: companyList">
                  <tr data-bind="css: { info: _id() == \$parent.activeCompanyId() }">
                    <td>
                      <div class="btn-group" role="group">
                        <a class="btn btn-info" data-bind="attr: { href: '#/page/company_show/' + _id() }">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        </a>
                        <button type="button" class="btn btn-info" data-bind="click: \$parent.activateCompany, disable: _id() == \$parent.activeCompanyId()">
                            <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
                        </button>
                      </div>
                    </td>
                    <td><p class="form-control-static" data-bind="text: name"></p></td>
                    <td><p class="form-control-static" data-bind="text: addr1"></p></td>
                    <td><p class="form-control-static" data-bind="text: addr2"></p></td>
                    <td><p class="form-control-static" data-bind="text: addr3"></p></td>
                  </tr>
                </tbody>
              </table>
            </p>

            <div class="btn-group" role="group">
              <a href="#/page/company_new" type="button" class="btn btn-success">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                ${i18n.t('app.companyList.newCompanyBtn')}
              </a>
            </div>
          </form>
        </div>

        <div id="app-company_new" data-bind="visible: currentView() == 'company_new' || (currentView() != undefined && currentView().search('company_show') == 0)" style="display: none">
          <div class="form-horizontal">
            <div class="panel-group">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.generalPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">${i18n.t('app.company.companyNameLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="name" class="form-control" data-bind="value: data.name, css: data.hasErrorCss"></input>
                    </div>
                  </div>
                  <div for="idx from 1 to 3">
                    <div class="form-group">
                      <label for="addr${idx}" class="col-sm-2 control-label">${i18n.t('app.company.addrLbl', {nr: "${idx}"})}</label>
                      <div class="col-sm-4">
                        <input type="text" id="addr${idx}" class="form-control" data-bind="value: data.addr${idx}"></input>
                      </div>
                    </div>
                  </div>
                  <hr/>
                  <div class="form-group">
                    <label for="vatNr" class="col-sm-2 control-label">${i18n.t('app.company.vatNrLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="vatNr" class="form-control" data-bind="value: data.vatNr"></input>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="orgNr" class="col-sm-2 control-label">${i18n.t('app.company.orgNrLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="orgNr" class="form-control" data-bind="value: data.orgNr"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.contactPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="row">
                    <div class="col-md-2">
                      <label class="control-label">${i18n.t('app.company.contactCaptionHeader')}</label>
                    </div>
                    <div class="col-md-3">
                      <label class="control-label">${i18n.t('app.company.contactInfoHeader')}</label>
                    </div>
                  </div>
                  <div class="row top5" for="idx in [1,2,3]">
                    <div class="col-md-2">
                      <input type="text" id="contact${idx}Cap" class="form-control" data-bind="value: data.contact${idx}Caption"></input>
                    </div>
                    <div class="col-md-3">
                      <input type="text" id="contact${idx}" class="form-control" data-bind="value: data.contact${idx}"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.paymentOptPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="row">
                    <div class="col-md-2">
                      <label class="control-label">${i18n.t('app.company.paymentOptCaptionHeader')}</label>
                    </div>
                    <div class="col-md-3">
                      <label class="control-label">${i18n.t('app.company.paymentOptInfoHeader')}</label>
                    </div>
                    <div class="col-md-3">
                      <label class="control-label">${i18n.t('app.company.paymentOptFocusHeader')}</label>
                    </div>
                  </div>
                  <div class="row top5" for="idx in [1,2,3]">
                    <div class="col-sm-2">
                      <input type="text" id="pay${idx}Cap" class="form-control" data-bind="value: data.payment${idx}Caption"></input>
                    </div>
                    <div class="col-sm-3">
                      <input type="text" id="pay${idx}" class="form-control" data-bind="value: data.payment${idx}"></input>
                    </div>
                    <div class="col-sm-3">
                      <div class="radio">
                        <label>
                          <input type="radio" data-bind="checked: data.paymentFocus" value="${idx}" name="paymentFocusRadios">
                        </label>
                      </div>
                    </div>
                  </div>
                  <hr/>
                  <div class="form-group">
                    <label for="payCustomText" class="col-md-2 control-label">${i18n.t('app.company.paymentOptCustomTextHeader')}</label>
                    <div class="col-md-3">
                      <input type="text" id="payCustomText" class="form-control" data-bind="value: data.paymentCustomText"></input>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="defNumDaysUntilPayment" class="col-md-2 control-label">${i18n.t('app.company.paymentOptDefNumDaysUntilPayLbl')}</label>
                    <div class="col-md-3">
                      <input type="number" class="form-control" id="defNumDaysUntilPayment" data-bind="value: data.defaultNumDaysUntilPayment">
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.customTextFieldsPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="reverseChargeText" class="col-sm-2 control-label">${i18n.t('app.company.customTextFieldsReverseChargeTextLbl')}</label>
                    <div class="col-sm-6">
                      <textarea rows="4" id="reverseChargeText" class="form-control" data-bind="value: data.reverseChargeText" aria-describedby="reverseChargeTextHelp"></textarea>
                      <span id="reverseChargeTextHelp" class="help-block">${i18n.t('app.company.customTextFieldsReverseChargeHelpText')}</span>
                      <button class="btn btn-default btn-sm" data-bind="click: setDefaultReverseChargeText">${i18n.t('app.company.customTextFieldsReverseChargeSetDefaultBtn')}</button>
                    </div>
                  </div>
                  <hr/>
                  <div class="form-group">
                    <label for="footerText" class="col-sm-2 control-label">${i18n.t('app.company.customTextFieldsFooterTextLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="footerText" class="form-control" data-bind="value: data.vatNrCustomText"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.countersPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="cid" class="col-sm-2 control-label">${i18n.t('app.company.countersNextCustomerNrLbl')}</label>
                    <div class="col-sm-4">
                      <input type="number" id="cid" class="form-control" data-bind="value: data.nextCid, disable: currentView() != 'company_new'"></input>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="iid" class="col-sm-2 control-label">${i18n.t('app.company.countersNextInvoiceNrLbl')}</label>
                    <div class="col-sm-4">
                      <input type="number" id="iid" class="form-control" data-bind="value: data.nextIid, disable: currentView() != 'company_new'"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.company.logoPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <p data-bind="visible: data._id() == undefined">${i18n.t('app.company.logoUploadCompanyNotSavedText')}</p>
                  <div data-bind="visible: data._id() != undefined">
                    <div class="row">
                      <form class="form-horizontal"
                            action="/api/company_logo"
                            accept="image/gif, image/jpeg, image/png"
                            method="POST"
                            enctype="multipart/form-data"
                            data-bind="submit: uploadLogo">
                        <div class="col-sm-6">
                          <div class="input-group">
                            <input type="file" name="logo" id="companyLogoInput" class="form-control" placeholder="${i18n.t('app.company.logoSelectPlaceholder')}" data-bind="value: companyLogoInput"></input>
                            <span class="input-group-btn">
                              <button class="btn btn-default" type="submit" data-bind="css: {'btn-primary': companyLogoInput() != ''}">
                                <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
                                ${i18n.t('app.company.logoUploadBtn')}
                              </button>
                            </span>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="row">
                      <div class="col-sm-6">
                        <img id="companyLogoImg" data-bind="attr: { src: logoPath }" class="img-thumbnail"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-success" data-bind="click: saveCompany">
                <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                ${i18n.t('app.company.companySaveBtn')}
              </button>
            </div>
          </div>
        </div>

        <div id="app-customer" data-bind="visible: currentView() == 'customers'" style="display: none">
          <form>
            <p>
              <table class="table table-striped table-condensed">
                <thead>
                  <tr>
                      <th></th>
                      <th>${i18n.t('app.customerList.cidCol')}</th>
                      <th>${i18n.t('app.customerList.nameCol')}</th>
                      <th>${i18n.t('app.customerList.addrCol', {nr: 1})}</th>
                      <th>${i18n.t('app.customerList.addrCol', {nr: 2})}</th>
                      <th>${i18n.t('app.customerList.addrCol', {nr: 3})}</th>
                      <th>${i18n.t('app.customerList.phoneCol', {nr: 1})}</th>
                      <th>${i18n.t('app.customerList.phoneCol', {nr: 2})}</th>
                  </tr>
                </thead>
                <tbody data-bind="foreach: customerList">
                  <tr>
                      <td>
                        <div class="btn-group" role="group">
                          <a class="btn btn-info" data-bind="attr: { href: '#/page/customer_show/' + _id() }">
                              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                          </a>
                        </div>
                      </td>
                      <td><p class="form-control-static" data-bind="text: cid, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: name, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: addr1, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: addr2, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: addr3, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: phone1, visible: isValid"></p></td>
                      <td><p class="form-control-static" data-bind="text: phone2, visible: isValid"></p></td>
                  </tr>
                </tbody>
              </table>
            </p>

            <div class="btn-group" role="group">
                <a href="#/page/customer_new" type="button" class="btn btn-success">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    ${i18n.t('app.customerList.newCustomerBtn')}
                </a>
            </div>
          </form>
        </div>

        <div id="app-customer_new" data-bind="visible: currentView() == 'customer_new' || (currentView() != undefined && currentView().search('customer_show') == 0)" style="display: none">
          <div class="form-horizontal">
            <div class="panel-group">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.customer.generalInfoPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="cid" class="col-sm-2 control-label">${i18n.t('app.customer.customerNrLbl')}</label>
                    <div class="col-sm-4">
                      <p id="cid" class="form-control-static" data-bind="text: data.cid, visible: data.isValid"></p>
                    </div>
                  </div>
                  <hr/>
                  <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">${i18n.t('app.customer.nameLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="name" class="form-control" data-bind="value: data.name"></input>
                    </div>
                  </div>
                  <div for="idx in [1,2,3]">
                    <div class="form-group">
                      <label for="addr${idx}" class="col-sm-2 control-label">${i18n.t('app.customer.addrLbl', {nr: "${idx}"})}</label>
                      <div class="col-sm-4">
                        <input type="text" id="addr${idx}" class="form-control" data-bind="value: data.addr${idx}"></input>
                      </div>
                    </div>
                  </div>
                  <hr/>
                  <div class="form-group">
                    <label for="vatNr" class="col-sm-2 control-label">${i18n.t('app.customer.vatNrLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="vatNr" class="form-control" data-bind="value: data.vatNr"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.customer.contactInfoPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="contact" class="col-sm-2 control-label">${i18n.t('app.customer.contactLbl')}</label>
                    <div class="col-sm-4">
                      <input type="text" id="contact" class="form-control" data-bind="value: data.contact"></input>
                    </div>
                  </div>
                  <div for="idx in [1,2,3]">
                    <div class="form-group">
                      <label for="phone${idx}" class="col-sm-2 control-label">${i18n.t('app.customer.phoneLbl', {nr: "${idx}"})}</label>
                      <div class="col-sm-4">
                        <input type="text" id="phone${idx}" class="form-control" data-bind="value: data.phone${idx}"></input>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">${i18n.t('app.customer.emailLbl')}</label>
                    <div class="col-sm-4">
                      <input type="email" id="email" class="form-control" data-bind="value: data.email"></input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.customer.optionPaneHeader')}</h3>
                </div>
                <div class="panel-body">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: data.useReverseCharge" aria-label=" ${i18n.t('app.customer.optionUseReverseChargeLbl')}">
                      ${i18n.t('app.customer.optionUseReverseChargeLbl')}
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-success" data-bind="click: saveCustomer">
                <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                ${i18n.t('app.customer.saveBtn')}
              </button>
            </div>
          </div>
        </div>

        <div id="app-invoices" data-bind="visible: currentView() == 'invoices'" style="display: none">
          <form>
              <p>
                  <table class="table table-striped table-condensed">
                      <colgroup>
                        <col class="col-md-1"> <!-- Controls -->
                        <col class="col-md-1"> <!-- Nr -->
                        <col class="col-md-1"> <!-- Date -->
                        <col class="col-md-1"> <!-- Customer nr -->
                        <col class="col-md-3"> <!-- Customer name -->
                        <col class="col-md-2"> <!-- Total excl VAT -->
                        <col class="col-md-1"> <!-- isPaid -->
                        <col class="col-md-1"> <!-- isCredit -->
                        <col class="col-md-1"> <!-- isCanceled -->
                      </colgroup>
                      <thead>
                          <tr>
                              <th></th>
                              <th>
                                 ${i18n.t('app.invoiceList.colNr')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('iid')">
                                    <span data-bind="if: invoiceListSort() !== 'iidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'iidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colDate')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('date')">
                                    <span data-bind="if: invoiceListSort() !== 'dateAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'dateAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colCustomerNr')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('cid')">
                                    <span data-bind="if: invoiceListSort() !== 'cidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'cidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colCustomerName')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('customer')">
                                    <span data-bind="if: invoiceListSort() !== 'customerAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'customerAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colTotalExclVat')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('totalExclVat')">
                                    <span data-bind="if: invoiceListSort() !== 'totalExclVatAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'totalExclVatAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colIsPaid')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('paid')">
                                    <span data-bind="if: invoiceListSort() !== 'paidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'paidAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doToggleShowPaid">
                                    <span data-bind="if: showPaid">
                                        <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="ifnot: showPaid">
                                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colIsCredit')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('credit')">
                                    <span data-bind="if: invoiceListSort() !== 'creditAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'creditAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doToggleShowCredit">
                                    <span data-bind="if: showCredit">
                                        <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="ifnot: showCredit">
                                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                              <th>
                                ${i18n.t('app.invoiceList.colIsCanceled')}
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doSortToggle('canceled')">
                                    <span data-bind="if: invoiceListSort() !== 'canceledAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="if: invoiceListSort() === 'canceledAsc'">
                                        <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
                                    </span>
                                </button>
                                <button type="button" class="btn btn-default btn-xs" data-bind="click: doToggleShowCanceled">
                                    <span data-bind="if: showCanceled">
                                        <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                                    </span>
                                    <span data-bind="ifnot: showCanceled">
                                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                                    </span>
                                </button>
                              </th>
                          </tr>
                      </thead>
                      <tbody data-bind="foreach: invoiceList">
                          <tr data-bind="if: (!isPaid() || (\$root.showPaid() && isPaid())) &&
                                             (!isCredit() || (\$root.showCredit() && isCredit())) &&
                                             (!isCanceled() || (\$root.showCanceled() && isCanceled())),
                                         css: { danger: (!isPaid() && isOverdue()) }">
                              <td>
                                <div class="btn-group" role="group">
                                  <a class="btn btn-info" data-bind="attr: { href: '#/page/invoice_show/' + _id() }">
                                      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                  </a>
                                  <a class="btn btn-info" data-bind="click: printInvoice">
                                      <span class="glyphicon glyphicon-print" aria-hidden="true"></span>
                                  </a>
                                </div>
                              </td>
                              <td>
                                <p>
                                  <span class="form-control-static" data-bind="text: iid"></span>
                                  <invoke function="condLockIcon" cond="isLocked"/>
                                </p>
                              </td>
                              <td><p class="form-control-static" data-bind="text: date"></p></td>
                              <td><p class="form-control-static" data-bind="text: customer().cid"></p></td>
                              <td><p class="form-control-static" data-bind="text: customer().name"></p></td>
                              <td><p class="form-control-static" data-bind="text: totalExclVatStr"></p></td>
                              <td>
                                  <p>
                                    <invoke function="condCheckIcon" cond="isPaid"/>
                                  </p>
                              </td>
                              <td>
                                  <p>
                                    <invoke function="condCheckIcon" cond="isCredit"/>
                                  </p>
                              </td>
                              <td>
                                  <p>
                                    <invoke function="condCheckIcon" cond="isCanceled"/>
                                  </p>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </p>

              <div class="btn-group" role="group">
                  <a href="#/page/invoice_new" type="button" class="btn btn-success">
                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                      ${i18n.t('app.invoiceList.newInvoiceBtn')}
                  </a>
              </div>
          </form>
        </div>

        <div id="app-invoice_new" data-bind="visible: currentView() == 'invoice_new' || (currentView() != undefined && currentView().search('invoice_show') == 0)" style="display: none">
            <div class="row"> <!-- top panel -->
              <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">
                        <span data-bind="if: data.iid() === undefined && !data.isCredit()">
                          ${i18n.t('app.invoice.mainPanelHeader', {context: 'newInvoice'})}
                        </span>
                        <span data-bind="if: data.iid() === undefined && data.isCredit()">
                          ${i18n.t('app.invoice.mainPanelHeader', {context: 'newCreditInvoice'})}
                        </span>
                        <span data-bind="if: data.iid() != undefined && !data.isCredit()">
                          ${i18n.t('app.invoice.mainPanelHeader', {context: 'invoice'})} #<span data-bind="text: data.iid()"></span>
                        </span>
                        <span data-bind="if: data.iid() != undefined && data.isCredit()">
                          ${i18n.t('app.invoice.mainPanelHeader', {context: 'creditInvoice'})} #<span data-bind="text: data.iid()"></span>
                        </span>
                        <invoke function="condLockIcon" cond="data.isLocked"/>
                      </h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="customerId" class="control-label">${i18n.t('app.invoice.customerLbl')}</label>
                                    <select class="form-control" id="customerId"
                                      data-bind="options: customerList, value: selectedCustomer, disable: data.isLocked,
                                                optionsCaption: '${i18n.t('app.invoice.customerOptCap')}'">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="date" class="control-label">${i18n.t('app.invoice.dateLbl')}</label>
                                    <input type="date" class="form-control" id="date" data-bind="value: data.date, disable: data.isLocked"></input>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="daysUntilPayment" class="control-label">${i18n.t('app.invoice.daysUntilPayLbl')}</label>
                                    <input type="number" class="form-control" id="daysUntilPayment" data-bind="value: data.daysUntilPayment, disable: data.isLocked"></input>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="yourReference" class="control-label">${i18n.t('app.invoice.yourRefLbl')}</label>
                                    <input type="text" class="form-control" id="yourReference" data-bind="value: data.yourRef, disable: data.isLocked"></input>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="ourReference" class="control-label">${i18n.t('app.invoice.ourRefLbl')}</label>
                                    <input type="text" class="form-control" id="ourReference" data-bind="value: data.ourRef, disable: data.isLocked"></input>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="projectId" class="control-label">${i18n.t('app.invoice.projIdLbl')}</label>
                                    <input type="text" class="form-control" id="projectId" data-bind="value: data.projId, disable: data.isLocked"></input>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <label for="currencyInput" class="control-label">${i18n.t('app.invoice.currencyLbl')}</label>
                                    <select class="form-control" id="currencyInput"
                                      data-bind="options: currencyList, value: selectedCurrency, disable: data.isLocked">
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading"><h3 class="panel-title">${i18n.t('app.invoice.customerDetailsPaneHeader')}</h3></div>
                    <div class="panel-body">
                        <form class="form-horizontal">
                            <div>
                                <p class="form-control-static">
                                    ${i18n.t('app.invoice.customerDetailsCustomerNrLbl')}
                                    &nbsp;<span data-bind="text: data.customer().cid"></span>
                                </p>
                            </div>
                            <address>
                                <strong><span data-bind="text: data.customer().name"></span></strong><br/>
                                <span data-bind="text: data.customer().addr1"></span><br/>
                                <span data-bind="text: data.customer().addr2"></span><br/>
                                <span data-bind="text: data.customer().addr3"></span>
                            </address>
                        </form>
                    </div>
                </div>
              </div>
            </div> <!-- top panel -->

            <div class="row"> <!-- invoice items panel -->
              <div class="col-md-12">
                <div class="panel panel-default">
                  <div class="panel-body">
                    <html-comment> ko foreach: data.invoiceItemGroups </html-comment>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="panel" data-bind="css: {'panel-default': !isEditMode(), 'panel-warning': isEditMode}">
                            <div class="panel-heading invoice-item-group-panel-heading">
                              <div class="row">
                                <span data-bind="ifnot: isEditMode">
                                  <span class="col-md-7">
                                    <div class="form-inline">
                                      <div class="form-group">
                                        <p class="form-control-static panel-title">
                                          <span data-bind="text: title"></span>
                                        </p>
                                        <span data-bind="if: hasTitleExtraField">
                                          &nbsp;
                                          <input type="text" class="form-control" data-bind="value: titleExtraField"></input>
                                        </span>
                                      </div>
                                    </div>
                                  </span>
                                </span>
                                <span data-bind="if: isEditMode">
                                  <span class="col-md-5">
                                    <input type="text" class="form-control" data-bind="value: title"></input>
                                  </span>
                                  <span class="col-md-2">
                                    <input type="text" class="form-control input-sm" data-bind="value: name" id="grpNameInput"></input>
                                  </span>
                                </span>
                                <span class="col-md-5">
                                  <span class="pull-right">
                                    <span data-bind="ifnot: isEditMode">
                                      <span class="label label-default label-fix" data-bind="text: name"></span>
                                      <!-- <span class="label label-default label-fix" data-bind="text: numInvoiceItemsText"></span> -->
                                    </span>
                                    <span data-bind="if: isEditMode">
                                      <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-default btn-sm" data-bind="click: updateServerForceNew, disable: \$parent.data.isLocked">
                                          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                          ${i18n.t('app.invoice.groupEditSaveAsNewBtn')}
                                        </button>
                                        <button type="button" class="btn btn-default btn-sm dropdown-toggle right5" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                      data-bind="disable: \$parent.data.isLocked">
                                          <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                          <li>
                                            <a href="#" data-bind="click: updateServer">
                                              <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                                              ${i18n.t('app.invoice.groupEditUpdateExistingBtn')}
                                            </a>
                                          </li>
                                        </ul>
                                      </div>
                                    </span>
                                    <button class="btn right3"
                                            data-bind="click: toggleEditMode,
                                                       css: {'btn-default': !isEditMode(), 'btn-success': isEditMode},
                                                       disable: \$parent.data.isLocked">
                                      <div data-bind="ifnot: isEditMode">
                                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                      </div>
                                      <div data-bind="if: isEditMode">
                                        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                      </div>
                                    </button>
                                    <button class="btn btn-danger right5" data-bind="click: \$parent.data.deleteGroup, disable: \$parent.data.isLocked">
                                      <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                    </button>
                                    <div class="btn-group-vertical top0 bottom0" role="group">
                                      <button class="btn btn-default btn-xs" data-bind="click: \$parent.data.moveGroupUp, disable: \$parent.data.isLocked">
                                        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                                      </button>
                                      <button class="btn btn-default btn-xs" data-bind="click: \$parent.data.moveGroupDown, disable: \$parent.data.isLocked">
                                        <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                                      </button>
                                    </div>
                                  </span>
                                </span>
                              </div>
                              <div data-bind="if: isEditMode">
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="checkbox input-sm bottom0 top0">
                                      <label>
                                        <input type="checkbox" data-bind="checked: isQuickButton">
                                        ${i18n.t('app.invoice.groupEditIsQuickButtonCheckLbl')}
                                      </label>
                                    </div>
                                    <div class="checkbox input-sm bottom0 top0">
                                      <label>
                                        <input type="checkbox" data-bind="checked: hasTitleExtraField">
                                        ${i18n.t('app.invoice.groupEditHasTitleExtraFieldCheckLbl')}
                                      </label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <def function="labelWithEditMode(textVariable, cond)">
                              <span data-bind="ifnot: ${cond}">
                                <span data-bind="text: ${textVariable}"></span>
                              </span>
                              <span data-bind="if: ${cond}">
                                <input type="text" class="form-control" data-bind="value: ${textVariable}"></input>
                              </span>
                            </def>

                            <table class="table table-striped table-condensed">
                                <colgroup>
                                  <col class="col-md-2">
                                  <col class="col-md-3">
                                  <col class="col-md-1">
                                  <col class="col-md-2">
                                  <col class="col-md-1">
                                  <col class="col-md-1">
                                  <col class="col-md-2">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th style="vertical-align:top">
                                        </th>
                                        <th style="vertical-align:top">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasDesc">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasDesc </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="descColLbl" cond="isEditMode"/>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                        <th style="vertical-align:top">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasCount">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasCount </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="countColLbl" cond="isEditMode"/>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                        <th style="vertical-align:top">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasPrice">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasPrice </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="priceColLbl" cond="isEditMode"/>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                        <th style="vertical-align:top">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasDiscount">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasDiscount </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="discountColLbl" cond="isEditMode"/>
                                            <div data-bind="if: isEditMode">
                                              <div class="checkbox input-sm">
                                                <label>
                                                  <input type="checkbox" data-bind="checked: negateDiscount">
                                                  ${i18n.t('app.invoice.groupEditNegateDiscountCheckLbl')}
                                                </label>
                                              </div>
                                            </div>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                        <th style="vertical-align:top">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasVat">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasVat </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="vatColLbl" cond="isEditMode"/>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                        <th style="vertical-align:top;text-align:right">
                                          <div data-bind="if: isEditMode">
                                            <div class="checkbox input-sm">
                                              <label>
                                                <input type="checkbox" data-bind="checked: hasTotal">
                                                ${i18n.t('app.invoice.groupEditColActiveCheckLbl')}
                                              </label>
                                            </div>
                                          </div>
                                          <html-comment> ko if: hasTotal </html-comment>
                                            <invoke function="labelWithEditMode" textVariable="totalColLbl" cond="isEditMode"/>
                                          <html-comment> /ko </html-comment>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: invoiceItems">
                                    <tr>
                                        <td>
                                          <div class="form-inline">
                                            <div class="form-group">
                                              <button class="btn btn-danger btn-sm" data-bind="click: \$parent.deleteInvoiceItem, disable: \$parents[1].data.isLocked">
                                                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                              </button>
                                              <div class="checkbox input-sm">
                                                <label>
                                                  <input type="checkbox" data-bind="checked: isTextOnly">
                                                  ${i18n.t('app.invoice.detailsIsTextOnlyCheckLbl')}
                                                </label>
                                              </div>
                                            </div>
                                          </div>
                                        </td>
                                        <td data-bind="attr: {colspan: descriptionColspan}">
                                          <html-comment> ko if: hasDesc </html-comment>
                                            <textarea class="form-control"
                                              data-bind="textInput: description, disable: \$parents[1].data.isLocked,
                                                         attr: {rows: descriptionNumRows}"></textarea>
                                          <html-comment> /ko </html-comment>
                                        </td>
                                        <html-comment> ko if: descriptionColspan() < 2 </html-comment>
                                          <td>
                                            <html-comment> ko if: hasCount </html-comment>
                                              <input type="number" class="form-control" data-bind="textInput: count, disable: \$parents[1].data.isLocked"></input>
                                            <html-comment> /ko </html-comment>
                                          </td>
                                        <html-comment> /ko </html-comment>
                                        <html-comment> ko if: descriptionColspan() < 3 </html-comment>
                                          <td>
                                            <html-comment> ko if: hasPrice </html-comment>
                                              <input type="number" class="form-control" data-bind="textInput: price, disable: \$parents[1].data.isLocked"></input>
                                            <html-comment> /ko </html-comment>
                                          </td>
                                        <html-comment> /ko </html-comment>
                                        <html-comment> ko if: descriptionColspan() < 4 </html-comment>
                                          <td>
                                            <html-comment> ko if: hasDiscount </html-comment>
                                              <input type="number" class="form-control" data-bind="textInput: discount, disable: \$parents[1].data.isLocked"></input>
                                            <html-comment> /ko </html-comment>
                                          </td>
                                        <html-comment> /ko </html-comment>
                                        <html-comment> ko if: descriptionColspan() < 5 </html-comment>
                                          <td>
                                            <html-comment> ko if: hasVat </html-comment>
                                              <input type="number" class="form-control" data-bind="textInput: vat, disable: \$parents[1].data.isLocked"></input>
                                            <html-comment> /ko </html-comment>
                                          </td>
                                        <html-comment> /ko </html-comment>
                                        <html-comment> ko if: descriptionColspan() < 6 </html-comment>
                                          <td>
                                            <html-comment> ko if: hasTotal </html-comment>
                                              <p class="form-control-static text-right" data-bind="text: totalStr"></p>
                                            <html-comment> /ko </html-comment>
                                          </td>
                                        <html-comment> /ko </html-comment>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <td colspan="3">
                                      <button class="btn btn-success" data-bind="click: newInvoiceItem, disable: \$parent.data.isLocked">
                                          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                          ${i18n.t('app.invoice.detailsNewRowBtn')}
                                      </button>
                                    </td>
                                    <td colspan="3">
                                      <p class="form-control-static text-right">
                                        ${i18n.t('app.invoice.groupTotalExclVatLbl')}
                                      </p>
                                    </td>
                                    <td>
                                      <p class="form-control-static text-right">
                                        <span data-bind="text: totalExclVatStr"></span>
                                      </p>
                                    </td>
                                </tfoot>
                            </table>
                          </div>
                        </div>
                      </div>
                    <html-comment> /ko </html-comment>

                    <div class="row"> <!-- invoice group summary and controls -->
                      <div class="col-md-6">
                        <div class="btn-group" role="group">
                          <html-comment> ko foreach: itemGroupList </html-comment>
                            <html-comment> ko if: isQuickButton </html-comment>
                              <button type="button" class="btn btn-primary" data-bind="click: \$parent.newGroup.bind(\$data), disable: \$parent.data.isLocked">
                                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                <span data-bind="text: name"></span>
                              </button>
                            <html-comment> /ko </html-comment>
                          <html-comment> /ko </html-comment>
                          <div class="btn-group">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                          data-bind="disable: data.isLocked">
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" data-bind="foreach: itemGroupList">
                              <html-comment> ko ifnot: isQuickButton </html-comment>
                                <li>
                                  <a href="#" data-bind="click: \$parent.newGroup.bind(\$data)">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>  
                                    <span data-bind="text: name"></span>
                                  </a>
                                </li>
                              <html-comment> /ko </html-comment>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <p class="form-control-static text-right">
                          ${i18n.t('app.invoice.totalExclVatLbl')}<br/>
                          <strong>${i18n.t('app.invoice.totalInclVatLbl')}</strong>
                        </p>
                      </div>
                      <div class="col-md-2">
                        <p class="form-control-static text-right">
                          <span data-bind="text: data.totalExclVatStr"></span><br/>
                          <strong><span data-bind="text: data.totalInclVatStr"></span></strong>
                        </p>
                      </div>
                    </div> <!-- invoice group summary and controls -->

                  </div>
                </div>
              </div>
            </div> <!-- invoice items panel -->
            
            <div class="row"> <!-- checkbox panel -->
              <div class="col-md-12">
                <div class="panel panel-default">
                  <div class="panel-body">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: data.isLocked">
                        ${i18n.t('app.invoice.optIsLockedLbl')}
                      </label>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: data.isPaid">
                        ${i18n.t('app.invoice.optIsPaidLbl')}
                      </label>
                    </div>
                    <div class="checkbox" data-bind="css: {disabled: data.isLocked}">
                      <label>
                        <input type="checkbox" value="" data-bind="checked: data.isCredit, disable: data.isLocked">
                        ${i18n.t('app.invoice.optIsCreditLbl')}
                      </label>
                    </div>
                    <div class="checkbox" data-bind="css: {disabled: data.isLocked}">
                      <label>
                        <input type="checkbox" value="" data-bind="checked: data.isCanceled, disable: data.isLocked">
                        ${i18n.t('app.invoice.optIsCanceledLbl')}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div> <!-- checkbox panel -->

            <div class="row"> <!-- buttons panel -->
              <div class="col-md-12">
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-success" data-bind="click: saveInvoice">
                      <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                      ${i18n.t('app.invoice.saveInvoiceBtn')}
                  </button>
                  <button type="button" class="btn btn-info" data-bind="click: doInvoicePrint">
                      <span class="glyphicon glyphicon-print" aria-hidden="true"></span>
                      ${i18n.t('app.invoice.printInvoiceBtn')}
                  </button>
                  <button type="button" class="btn btn-info" data-bind="click: doCopyInvoice">
                      <span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span>
                      ${i18n.t('app.invoice.copyInvoiceBtn')}
                  </button>
                </div>
              </div>
            </div> <!-- buttons panel -->
        </div>

        <div id="app-invoice_item_group_templates" data-bind="visible: currentView() == 'invoice_item_group_templates'" style="display: none">
          <form>
            <p>
              <ul class="list-group">
                <li class="list-group-item">
                  <div class="row">
                    <h4 class="col-md-offset-4 col-md-7 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.columnNameColHeader')}
                    </h4>
                  </div>
                  <div class="row">
                    <h4 class="col-md-2 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.nameCol')}
                    </h4>
                    <h4 class="col-md-2 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.titleCol')}
                    </h4>
                    <h4 class="col-md-2 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.descCol')}
                    </h4>
                    <h4 class="col-md-1 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.countCol')}
                    </h4>
                    <h4 class="col-md-1 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.priceCol')}
                    </h4>
                    <h4 class="col-md-1 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.discountCol')}
                    </h4>
                    <h4 class="col-md-1 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.vatCol')}
                    </h4>
                    <h4 class="col-md-1 list-group-item-heading">
                      ${i18n.t('app.groupTemplates.totalCol')}
                    </h4>
                  </div>
                </li>

                <def function="itemTextWithEditMode(textVariable, cond)">
                  <div data-bind="ifnot: isEditMode">
                    <div data-bind="if: ${cond}">
                      <p class="list-group-item-text" data-bind="text: ${textVariable}"></p>
                    </div>
                  </div>
                  <div data-bind="if: isEditMode">
                    <input type="text" class="form-control input-sm" data-bind="value: ${textVariable}, enable: ${cond}"></input>
                  </div>
                </def>

                <html-comment> ko foreach: groupList </html-comment>
                  <li class="list-group-item" data-bind="css: {'list-group-item-warning': isEditMode}">
                    <div class="row">
                      <div class="col-md-2">
                        <invoke function="itemTextWithEditMode" textVariable="name" cond="true"/>
                      </div>
                      <div class="col-md-2">
                        <invoke function="itemTextWithEditMode" textVariable="title" cond="true"/>
                      </div>
                      <div class="col-md-2">
                        <invoke function="itemTextWithEditMode" textVariable="descColLbl" cond="hasDesc"/>
                      </div>
                      <div class="col-md-1">
                        <invoke function="itemTextWithEditMode" textVariable="countColLbl" cond="hasCount"/>
                      </div>
                      <div class="col-md-1">
                        <invoke function="itemTextWithEditMode" textVariable="priceColLbl" cond="hasPrice"/>
                      </div>
                      <div class="col-md-1">
                        <invoke function="itemTextWithEditMode" textVariable="discountColLbl" cond="hasDiscount"/>
                      </div>
                      <div class="col-md-1">
                        <invoke function="itemTextWithEditMode" textVariable="vatColLbl" cond="hasVat"/>
                      </div>
                      <div class="col-md-1">
                        <invoke function="itemTextWithEditMode" textVariable="totalColLbl" cond="hasTotal"/>
                      </div>
                      <div class="col-md-1">
                        <div class="pull-right">
                          <div class="btn-group" role="group">
                            <button type="button" class="btn btn-primary btn-sm" data-bind="click: toggleEditMode">
                              <span data-bind="if: isEditMode">
                                <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>
                              </span>
                              <span data-bind="ifnot: isEditMode">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                              </span>
                            </button>
                            <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                              <li>
                                <a href="#" data-bind="click: \$parent.deleteGroup">
                                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                  ${i18n.t('app.groupTemplates.deleteGroupBtn')}
                                </a>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row" data-bind="visible: isEditMode">
                      <div class="col-md-2">
                      </div>
                      <div class="col-md-2">
                      </div>
                      <div class="col-md-2">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasDesc">
                            ${i18n.t('app.groupTemplates.hasDescCheckLbl')}
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasCount">
                            ${i18n.t('app.groupTemplates.hasCountCheckLbl')}
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasPrice">
                            ${i18n.t('app.groupTemplates.hasPriceCheckLbl')}
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasDiscount">
                            ${i18n.t('app.groupTemplates.hasDiscountCheckLbl')}
                          </label>
                        </div>
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: negateDiscount">
                            ${i18n.t('app.groupTemplates.negateDiscountCheckLbl')}
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasVat">
                            ${i18n.t('app.groupTemplates.hasVatCheckLbl')}
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasTotal">
                            ${i18n.t('app.groupTemplates.hasTotalCheckLbl')}
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="row" data-bind="visible: isEditMode">
                      <div class="col-md-12">
                        <div class="checkbox input-sm bottom0 top0">
                          <label>
                            <input type="checkbox" data-bind="checked: hasTitleExtraField">
                            ${i18n.t('app.groupTemplates.hasTitleExtraFieldCheckLbl')}
                          </label>
                        </div>
                        <div class="checkbox input-sm top0">
                          <label>
                            <input type="checkbox" data-bind="checked: isQuickButton">
                            ${i18n.t('app.groupTemplates.isQuickButtonCheckLbl')}
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="row" data-bind="visible: isEditMode">
                      <div class="col-md-12">
                        <div class="btn-group" role="group">
                          <button type="button" class="btn btn-success" data-bind="click: updateServer, visible: isEditMode">
                            <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                            ${i18n.t('app.groupTemplates.saveGroupBtn')}
                          </button>
                        </div>
                      </div>
                    </div>
                  </li>
                <html-comment> /ko </html-comment>
              </ul>

            </p>

            <div class="btn-group" role="group">
                <button type="button" class="btn btn-success" data-bind="click: newGroup">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                  ${i18n.t('app.groupTemplates.newTemplateBtn')}
                </button>
            </div>
          </form>
        </div>

        <div id="app-settings" data-bind="visible: currentView() == 'settings'" style="display: none">
          <div class="page-header">
              <h1>${i18n.t('app.settings.pageHeader')}</h1>
          </div>

          <div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">${i18n.t('app.settings.userInfoPanelTitle')}</h3>
                </div>
                <div class="panel-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <label for="license" class="control-label">${i18n.t('app.settings.licenseLbl')}</label>
                        <p class="form-control-static" id="license" data-bind="text: settings.license"></p>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <label for="email" class="control-label">${i18n.t('app.settings.emailLbl')}</label>
                        <p class="form-control-static" id="email">$data.user.email</p>
                      </div>
                      </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <label for="regDate" class="control-label">${i18n.t('app.settings.regDateLbl')}</label>
                        <p class="form-control-static" id="regDate">$data.user.registrationDate</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-warning" data-bind="click: invalidateCache">
                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                  ${i18n.t('app.settings.invalidateCacheBtn')}
                </button>
              </div>
          </div>
        </div>

        <div if="data.user.isAdmin === true">
          <div id="app-debug" data-bind="visible: currentView() == 'debug'" style="display: none">
            <div class="page-header">
                <h1>${i18n.t('app.debugAndTest.pageHeader')}</h1>
            </div>

            <div>
                <form>
                    <p>
                    </p>
                    <div class="row">
                      <div class="btn-group" role="group" aria-label="...">
                          <button type="button" class="btn btn-default" data-bind="click: spinnerVisible.bind(\$data,true), css: { active: spinnerVisible==true}">
                              ${i18n.t('app.debugAndTest.showSpinnerBtn')}
                          </button>
                          <button type="button" class="btn btn-default" data-bind="click: spinnerVisible.bind(\$data,false), css: { active: spinnerVisible==false}">
                              ${i18n.t('app.debugAndTest.hideSpinnerBtn')}
                          </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="btn-group" role="group" aria-label="...">
                          <button type="button" class="btn btn-default" data-bind="click: showInfoMsg">
                              ${i18n.t('app.debugAndTest.showInfoMsgBtn')}
                          </button>
                          <button type="button" class="btn btn-default" data-bind="click: showSuccessMsg">
                              ${i18n.t('app.debugAndTest.showSuccessMsgBtn')}
                          </button>
                          <button type="button" class="btn btn-default" data-bind="click: showWarningMsg">
                              ${i18n.t('app.debugAndTest.showWarningMsgBtn')}
                          </button>
                          <button type="button" class="btn btn-default" data-bind="click: showErrorMsg">
                              ${i18n.t('app.debugAndTest.showErrorMsgBtn')}
                          </button>
                      </div>
                    </div>
                </form>
            </div>
          </div>
        
          <div id="app-users" data-bind="visible: currentView() == 'users'" style="display: none">
            <form>
                <p>
                  <ul class="list-group">
                    <li class="list-group-item">
                      <div class="row">
                        <h4 class="col-md-2 list-group-item-heading">
                          ${i18n.t('app.userList.nameCol')}
                        </h4>
                        <h4 class="col-md-3 list-group-item-heading">
                          ${i18n.t('app.userList.emailCol')}
                        </h4>
                        <h4 class="col-md-2 list-group-item-heading">
                          ${i18n.t('app.userList.typeCol')}
                        </h4>
                        <h4 class="col-md-1 list-group-item-heading">
                          ${i18n.t('app.userList.licenseCol')}
                        </h4>
                        <h4 class="col-md-2 list-group-item-heading">
                          ${i18n.t('app.userList.regDateCol')}
                        </h4>
                        <h4 class="col-md-1 list-group-item-heading">
                          ${i18n.t('app.userList.isAdminCol')}
                        </h4>
                      </div>
                    </li>
                    <html-comment> ko foreach: userList </html-comment>
                      <li class="list-group-item">
                        <div class="row">
                          <div class="col-md-2">
                            <p class="list-group-item-text" data-bind="text: info.name"></p>
                          </div>
                          <div class="col-md-3">
                            <p class="list-group-item-text" data-bind="text: info.email"></p>
                          </div>
                          <div class="col-md-2">
                            <p class="list-group-item-text" data-bind="text: type"></p>
                          </div>
                          <div class="col-md-1">
                            <p class="list-group-item-text" data-bind="text: settings().license"></p>
                          </div>
                          <div class="col-md-2">
                            <p class="list-group-item-text" data-bind="text: info.registrationDate"></p>
                          </div>
                          <div class="col-md-1">
                            <p class="list-group-item-text"><invoke function="condCheckIcon" cond="info.isAdmin"/></p>
                          </div>
                          <div class="col-md-1">
                            <button type="button" class="btn btn-default" data-bind="click: toggleDetailedInfo">
                              <span data-bind="if: isDetailsVisible">
                                <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>
                              </span>
                              <span data-bind="ifnot: isDetailsVisible">
                                <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                              </span>
                            </button>
                          </div>
                        </div>
                        <div class="row" data-bind="visible: isDetailsVisible">
                          <div class="col-md-11">
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <ul class="list-inline">
                                  <li>
                                    ${i18n.t('app.userList.numCompaniesLbl')}
                                    <span class="badge" data-bind="text: totalStats().numCompanies"></span>
                                  </li>
                                  <li>
                                    ${i18n.t('app.userList.numCustomersLbl')}
                                    <span class="badge" data-bind="text: totalStats().numCustomers"></span>
                                  </li>
                                  <li>
                                    ${i18n.t('app.userList.numInvoicesLbl')}
                                    <span class="badge" data-bind="text: totalStats().numInvoices"></span>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </li>
                    <html-comment> /ko </html-comment>
                  </ul>
                </p>
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-default" data-bind="click: refresh">
                    <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                    ${i18n.t('app.userList.refreshBtn')}
                  </button>
                </div>
            </form>
          </div>

          <div id="app-invites" data-bind="visible: currentView() == 'invites'" style="display: none">
            <form>
                <p>
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>${i18n.t('app.inviteList.emailCol')}</th>
                                <th>${i18n.t('app.inviteList.licenseCol')}</th> <th>${i18n.t('app.inviteList.isAdminCol')}</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: inviteList">
                            <tr>
                                <td><p class="form-control-static" data-bind="text: email"></p></td>
                                <td><p class="form-control-static" data-bind="text: license"></p></td>
                                <td><p class="form-control-static"><invoke function="condCheckIcon" cond="isAdmin"/></p></td>
                            </tr>
                        </tbody>
                    </table>
                </p>

                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-default" data-bind="click: refresh">
                    <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                    ${i18n.t('app.inviteList.refreshBtn')}
                  </button>
                </div>
            </form>
          </div>
        </div> <!-- End isAdmin -->
          
      </div>
    </div>
  </body>
  <script src="jquery.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="tooltip.js"></script>
  <script src="knockout-latest.js"></script>
  <script src="knockout-bootstrap.js"></script>
  <script src="director.min.js"></script>
  <script src="i18next.min.js"></script>
  <script src="cache.js"></script>

  <!-- Input to javascripts below -->
  <script>
      var cfg = {
          showInitialTicker: true,
          tickerText: "${i18n.t('app.tickerText')}",
          notificationAreaPlacement: "right",
          isAdmin: $data.user.isAdmin,
      };
      var serverMsg = {
          error: "$data.msg.error",
          success: "$data.msg.success",
          notice: "$data.msg.notice"
      };
  </script> 
  <script src="util.js"></script>
  <script src="notification.js"></script>
  <script src="page.js"></script>
</html>
